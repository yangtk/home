<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
<style>
    *{margin:0;padding:0;}
    #div1 { width:100px; height:100px; background:gray; position:absolute; cursor:pointer; }
</style>
<script>
window.onload = function(){ 

    var oDiv = document.getElementById('div1');
    var disX = 0;
    var disY = 0;

    oDiv.onmousedown = function(ev){ //http://398868310.iteye.com/blog/2147245  和这个不一样啊

        var oEvent = ev || event; // 位置注定，or ff报错找不到event。
        disX = oEvent.clientX - oDiv.offsetLeft;
        disY = oEvent.clientY - oDiv.offsetTop;

        document.onmousemove = function(ev){

            var oEvent = ev || event;
            var l = oEvent.clientX - disX;
            var t = oEvent.clientY - disY;
            var maxL = document.documentElement.clientWidth - oDiv.offsetWidth;
            var maxt = document.documentElement.clientHeight - oDiv.offsetHeight;

            if(l<0){
                l=0;
            }
            if(l>maxL){
                l=maxL;
            }
            if(t<0){
                t=0;
            }
            if(t>maxt){
                t=maxt;
            }

            oDiv.style.left =  l  + 'px';
            oDiv.style.top =  t  +'px';
        }

        document.onmouseup = function(){
            document.onmousemove = null;
            document.onmouseup = null;
        }

        return false;

    }

    // bug1 快速下会脱离                         使用document
    //bug2 火狐低版本下，第二次拖会出现一个禁止符号   使用return false   阻止此bug出现
    //bug3  拖拽到浏览器外，找不回来了              限定在可视区里；  

    //bug4  最大化，放在右下角，最小化，，又出去了。   未解决
   
    
}
</script>
</head>
<body>
    <div id="div1"></div>
</body>
</html>